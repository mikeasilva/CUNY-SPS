---
title: "DATA 612 Week #1 Textbook Exercises"
author: "Mike Silva"
date: "`r Sys.Date()`"
output:
  rmdformats::readthedown:
    highlight: kate
---


```{r knitr_init, echo=FALSE, cache=FALSE, warning=FALSE, message=FALSE}
library(knitr)
library(rmdformats)
library(tidyverse)
library(kableExtra)
library(gridExtra)
library(ggthemes)
## Global options
options(max.print="75")
opts_chunk$set(echo=FALSE,
	             cache=TRUE,
               prompt=FALSE,
               tidy=TRUE,
               comment=NA,
               message=FALSE,
               warning=FALSE)
opts_knit$set(width=75)
```

## LMR 1.1

The dataset *teengamb* concers a study of teenage gambline in Britain.  Make a numerical and graphical summary of the data, commenting on any features that you find interesting.  Limit the output you present to a quantity that a busy reader would find sufficient to get a basic understanding of the data.

**Estimates show teens in Britain gamble between 0 and 150 pounds annually.  Males gamble more than females.  They gamble on average nearly 8 times as much.**

```{r}
# A paper describing the original study can be found at http://www.utstat.utoronto.ca/reid/sta2201s/2012/teengamb.pdf.  First I will read in the data.  I will recode the sex variable making it easier to interpret.  The income variable is per week and the gambling is per year.  I will adjust the income to put it on the same basis.

teengamb <- read.delim("data/teengamb.txt") %>%
  mutate(sex = as.factor(ifelse(sex == 0, "Male", "Female")),
         income = income * 52)

plot1 <- ggplot(teengamb, aes(x = sex, color = sex, fill = sex)) +
  geom_bar(stat = "count") +
  ylab("Teens") + 
  xlab(element_blank()) +
  theme(legend.position = "none") +
  ggtitle("Respondents by Sex")

plot2 <- ggplot(teengamb, aes(x = sex, y = gamble, color=sex)) + 
  geom_boxplot() +
  ylab("Pounds") +
  xlab(element_blank()) +
  theme(legend.position = "none") +
  ggtitle("Estimated Annual Gambling by Sex")

grid.arrange(plot1, plot2, ncol = 2)
```

```{r}
temp <- teengamb %>%
  group_by(sex) %>%
  summarise(mpg = list(enframe(quantile(gamble, probs=c(0.25, 0.5, 0.75))))) %>% 
  unnest() %>%
  spread(name, value)

teengamb %>%
  group_by(sex) %>%
  summarise(`Min.` = min(gamble),
            Mean = mean(gamble),
            `Max.` = max(gamble), 
            Count = n()) %>%
  merge(temp) %>%
  select(sex, `Min.`, `25%`, `50%`, Mean, `75%`, `Max.`, Count) %>%
  kable() %>%
  kable_styling()
```

**Teens earned between 31 and 780 pounds annually.  Those who earned more were more likely to gamble more.**

```{r}
ggplot(teengamb, aes(x = income, y = gamble)) + 
  geom_point() + 
  geom_smooth(method = "lm") +
  xlab("Annual Income (Pounds)") +
  ylab("Annual Gambling (Pounds)") +
  ggtitle("Income vs. Gambling")
```

## LMR 1.3

The dataset *prostate* is from a study on 97 men with prostate conacer who were due to receive a radical prostatectomy.  Make a numerical and graphical summary of the data as in the first question.

```{r}
#lcavol log(cancer volume)
#lweight log(prostate weight)
#age age
#lbph log(benign prostatic hyperplasia amount)
#svi seminal vesicle invasion
#lcp log(capsular penetration)
#gleason Gleason score
#pgg45 percentage Gleason scores 4 or 5
#lpsa log(prostate specific antigen)

prostate <- read.delim("data/prostate.txt") 
```

**These men are generally older.  Their age ranges from 41 to 79 years.  The median age is 65.**

```{r}
ggplot(prostate, aes(x=age)) + 
  geom_histogram(bins=30) +
  ylab("Men") +
  xlab(element_blank()) + 
  ggtitle("Age of Men")

temp <- prostate %>%
  summarise(mpg = list(enframe(quantile(age, probs=c(0.25, 0.5, 0.75))))) %>% 
  unnest() %>%
  spread(name, value)

prostate %>%
  summarise(`Min.` = min(age),
            Mean = mean(age),
            `Max.` = max(age)) %>%
  merge(temp) %>%
  select(`Min.`, `25%`, `50%`, Mean, `75%`, `Max.`) %>%
  kable() %>%
  kable_styling()
```

**There is a direct relationship between the prostate cancer volume and the capsular penetration.**

```{r}
ggplot(prostate, aes(lcp, lcavol)) +
  geom_point() +
  geom_smooth(method = "lm") +
  xlab("Capsular Penetration (log)") +
  ylab("Cancer Volume (log)") +
  ggtitle("Cancer Volume and Capsular Penetration")
```

```{r}
temp <- prostate %>%
  summarise(mpg = list(enframe(quantile(lcp, probs=c(0.25, 0.5, 0.75))))) %>% 
  unnest() %>%
  spread(name, value)

prostate %>%
  summarise(`Min.` = min(lcp),
            Mean = mean(lcp),
            `Max.` = max(lcp)) %>%
  merge(temp) %>%
  select(`Min.`, `25%`, `50%`, Mean, `75%`, `Max.`) %>%
  kable() %>%
  kable_styling()
```

**The volume of the cancer is also positively correlated with the PSA.**

```{r}
ggplot(prostate, aes(lpsa, lcavol)) +
  geom_point() +
  geom_smooth(method = "lm") +
  xlab("PSA (log)") +
  ylab("Cancer Volume (log)") +
  ggtitle("Cancer Volume and PSA (Prostate Specific Antigen)")
```

```{r}
temp <- prostate %>%
  summarise(mpg = list(enframe(quantile(lpsa, probs=c(0.25, 0.5, 0.75))))) %>% 
  unnest() %>%
  spread(name, value)

prostate %>%
  summarise(`Min.` = min(lpsa),
            Mean = mean(lpsa),
            `Max.` = max(lpsa)) %>%
  merge(temp) %>%
  select(`Min.`, `25%`, `50%`, Mean, `75%`, `Max.`) %>%
  kable() %>%
  kable_styling()
```

## LMR 1.4

The dataset *sat* comes from a study entitled "Getting What You Pay For: The Debate Over Equity in Public School Expenditures."  Make a numerical and graphical summary of the data as in the first question.

**SAT scores range from 844 to 1107 with an average arround 966.  These data have considerable variability.**

```{r}
#  These variables include average annual expenditures per student, the student/teacher ratio, the average annual salary for teachers in each state, and the percentage of all eligible students taking the SAT. Finally, the three remaining variables in the dataset measure educational "output" (e.g., performance) using the SAT. Verbal and math scores appear separately, and an average total score is given for each state. 

sat <- read.delim("data/sat.txt") 

temp <- sat %>%
  summarise(mpg = list(enframe(quantile(total, probs=c(0.25, 0.5, 0.75))))) %>% 
  unnest() %>%
  spread(name, value)

sat %>%
  summarise(`Min.` = min(total),
            Mean = mean(total),
            `Max.` = max(total),
            Count = n()) %>%
  merge(temp) %>%
  select(`Min.`, `25%`, `50%`, Mean, `75%`, `Max.`, Count) %>%
  kable() %>%
  kable_styling()
```

**At first blush it appears that high schools that spend less per pupil do better on the SAT than those who spend more.  Strange!?!**

```{r}
ggplot(sat, aes(expend, total)) +
  geom_point() +
  geom_smooth(method = "lm") +
  xlab("1994-95 per Student Spending (thousands of dollars)") +
  ylab("Avg T SAT Score, 1994-95") +
  ggtitle("Spend Less for Better SAT Scores")
```

**But when you examine the popularity of the SAT test a different pattern emerges.  In certain states the ACT is the college enterance test of choice.  Thus the SAT scores in these state are only for the students who want to apply to a school back East.**

```{r}
ggplot(sat, aes(takers, total)) +
  geom_point() +
  geom_smooth(method = "lm") +
  xlab("Percent of Students Taking the SAT") +
  ylab("Avg. SAT Score, 1994-95") +
  ggtitle("SAT Self-Selection Bias")
```

## LMR 1.5

The dataset *divusa* contains data on divorces in the United States from 1920 to 1996.  Make a numerical and graphical summary of the data as in the first question.

```{r}
# year the year from 1920-1996
# divorce divorce per 1000 women aged 15 or more
# unemployed unemployment rate
# femlab percent female participation in labor force aged 16+
# marriage marriages per 1000 unmarried women aged 16+
# birth births per 1000 women aged 15-44
# military military personnel per 1000 population

divusa <- read.delim("data/divusa.txt")
```

**The US divorce rate has generally been increasing over time.  There was a spike in the 1940s and it has been trending down since the 1980.**

```{r}
ggplot(divusa, aes(year, divorce)) +
  geom_line() +
  ylab("Per 1,000 Women") +
  xlab(element_blank()) +
  ggtitle("U.S. Divorce Rate Over Time")
```

```{r}
divusa <- divusa %>%
  mutate(Decade = floor(year/10)*10)

temp <- divusa %>%
  group_by(Decade) %>%
  summarise(mpg = list(enframe(quantile(divorce, probs=c(0.25, 0.5, 0.75))))) %>% 
  unnest() %>%
  spread(name, value)

divusa %>%
  group_by(Decade) %>%
  summarise(`Min.` = min(divorce),
            Mean = mean(divorce),
            `Max.` = max(divorce), 
            Count = n()) %>%
  merge(temp) %>%
  select(Decade, `Min.`, `25%`, `50%`, Mean, `75%`, `Max.`, Count) %>%
  kable() %>%
  kable_styling()
```


**There are a couple of things that have a similar spike.  For example military personnel per 1000...**

```{r}
ggplot(divusa, aes(x = year)) +
  geom_line(aes(y = divorce, color = "Divorce")) +
  geom_line(aes(y = military, color = "Military")) + 
  scale_y_continuous(sec.axis = sec_axis(~.*1, name = "Per 1,000 People"))+ 
  scale_colour_manual(values = c("blue", "red")) +
  labs(y = "Per 1,000 Women", x = element_blank(), color = element_blank()) +
  theme(legend.position = "bottom") +
  ggtitle("Divorce and Military Personnel Rate")
```

**...the marriage rate...**

```{r}
ggplot(divusa, aes(x = year)) +
  geom_line(aes(y = divorce, color = "Divorce Rate")) +
  geom_line(aes(y = marriage, color = "Marriage")) +
  scale_colour_manual(values = c("blue", "red")) +
  labs(y = "Per 1,000 Women", x = element_blank(), color = element_blank()) +
  theme(legend.position = "bottom") +
  ggtitle("Divorce and Marriage Rate")
```

**...and most strikingly, the female labor force participation rate.**

```{r}
ggplot(divusa, aes(x = year)) +
  geom_line(aes(y = divorce, color = "Divorce Rate")) +
  geom_line(aes(y = femlab, color = "Female Labor Force Participation")) +
  scale_y_continuous(sec.axis = sec_axis(~.*1, name = "Percent of Working Age Females"))+ 
  scale_colour_manual(values = c("blue", "red")) +
  labs(y = "Per 1,000 Women", x = element_blank(), color = element_blank()) +
  theme(legend.position = "bottom") +
  ggtitle("Divorce Rate and Female Labor Force Participation")
```

