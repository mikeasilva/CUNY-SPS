<!DOCTYPE html>
<html>

<head>
    <title>CUNY SPS DATA 608 - Module 6</title>
    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" />
    <meta charset="UTF-8" />
    <meta name="author" content="Michael Silva" />
    <meta name="description" content="CUNY SPS DATA 608 Module 6" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        /*https://flatuicolors.com/palette/us*/
        html,
        body {
            font-family: "Open Sans", sans-serif;
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            background-color: #dfe6e9;
            color: #636e72;
        }

        * {
            box-sizing: border-box;
        }

        select {
            display: block;
            -webkit-appearance: none;
            -moz-appearance: none;
            -ms-appearance: none;
            -o-appearance: none;
            appearance: none;
            font-family: "Open Sans", sans-serif;
            font-size: 30px;
            background-color: white;
            cursor: pointer;
            height: 50px;
            line-height: 50px;
            width: 90%;
            margin: auto;
            margin-top: 20px;
            border: none;
            border-bottom: 2px solid #b2bec3;
            color: #2d3436;
            outline: none;
            padding-left: 10px;
            border-top-left-radius: 10px;
            border-top-right-radius: 10px;
            background-image: url('arrow-menu-down-gray.svg');
            background-size: 15px;
            background-position: calc(100% - 20px) 50%;
            background-repeat: no-repeat;
            padding-right: 12px;
        }

        .range {
            padding: 20px;
            width: 50%;
            margin: auto;
        }

        .viz_container {
            width: 90%;
            margin: auto;
            background: white;
            padding-bottom: 10px;
            border-bottom-left-radius: 10px;
            border-bottom-right-radius: 10px;
        }

        #toggle_container {
            padding-top: 5px;
            padding-left: 5px;
        }

        .slider {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 25px;
            background: #dfe6e9;
            outline: none;
            -webkit-transition: .2s;
            transition: opacity .2s;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 25px;
            height: 25px;
            background: white;
            border-radius: 25px;
            cursor: pointer;
            -webkit-box-shadow: 1px 0px 3px 0px #CFD8DC;
            box-shadow: 1px 0px 3px 0px #CFD8DC;
        }

        .slider::-moz-range-thumb {
            width: 25px;
            height: 25px;
            background: white;
            border-radius: 25px;
            cursor: pointer;
            -webkit-box-shadow: 1px 0px 3px 0px #CFD8DC;
            box-shadow: 1px 0px 3px 0px #CFD8DC;
        }

        .sliderticks {
            display: flex;
            justify-content: space-between;
            padding: 0 10px;
            font-size: 10px;
        }

        .sliderticks p {
            position: relative;
            display: flex;
            justify-content: center;
            text-align: center;
            width: 1px;
            background: #dfe6e9;
            height: 10px;
            /*line-height: 40px;*/
            margin: 0 0 20px 0;
            font-size: 14px;
            text-shadow: 0px -1px 0px #f5f7f8;
        }

        #scrolly {
            position: relative;
            display: -webkit-box;
            display: -ms-flexbox;
            display: flex;
            padding: 1rem;
        }

        #scrolly>* {
            -webkit-box-flex: 1;
            -ms-flex: 1;
            flex: 1;
        }

        article {
            position: relative;
            padding: 0 1rem;
            max-width: 40%;
        }

        figure.init #figure-1,
        figure.init #figure-2,
        figure.init #figure-3,
        figure.init #figure-4,
        figure.step-1 #figure-2,
        figure.step-1 #figure-3,
        figure.step-1 #figure-4,
        figure.step-2 #figure-1,
        figure.step-2 #figure-3,
        figure.step-2 #figure-4,
        figure.step-3 #figure-1,
        figure.step-3 #figure-2,
        figure.step-3 #figure-4,
        figure.step-4 #figure-1,
        figure.step-4 #figure-2,
        figure.step-4 #figure-3 {
            display: none;
        }

        figure {
            position: -webkit-sticky;
            position: sticky;
            width: 100%;
            margin: 0;
            -webkit-transform: translate3d(0, 0, 0);
            -moz-transform: translate3d(0, 0, 0);
            transform: translate3d(0, 0, 0);
            z-index: 0;
        }

        .step {
            margin: 0 auto 2rem auto;
        }

        .step:last-child {
            margin-bottom: 0;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 40px;
            height: 20px;
            background-color: #00b894;
            border-radius: 20px;
        }

        .switch::after {
            content: '';
            position: absolute;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background-color: white;
            top: 1px; // TO GIVE AN EFFECT OF CIRCLE INSIDE SWITCH.
            left: 1px;
            transition: all 0.3s;
        }

        .checkbox:checked+.switch::after {
            left: 20px;
        }

        .checkbox:checked+.switch {
            background-color: #b2bec3;
        }

        .checkbox {
            display: none;
        }
    </style>
</head>

<body>
    <main>
        <section id="intro">
            <center>
                <h1>New York State's Shrinking Middle Class</h1>
            </center>
        </section>
        <section id="scrolly">
            <article>
                <div class="step" data-step="1">
                    <img src="https://camo.githubusercontent.com/e6ce20fc9338ef162a723af0f4b758c31b66e6e7/687474703a2f2f7777772e6165692e6f72672f77702d636f6e74656e742f75706c6f6164732f323031392f30392f63656e7375736e6577312e706e67"
                        style="width:100%;" />
                </div>
                <div class="step" data-step="2">
                    <h2>New York's Story is Complicated</h2>
                    <p>The share of middle-income households in most NY counties has shrunk over time. Most experienced
                        their largest drop from 1980 to 1990. The rate of the contraction slowed in from 1990 to 2000.
                        The share of high-income households have grown, however some of those gains were given back
                        during the Great Recession.</p>
                </div>
                <div class="step" data-step="3">
                    <a name="3"></a>
                    <p>STEP 3</p>
                </div>
                <div class="step" data-step="4">
                    <h2>About This Project</h2>
                </div>
            </article>

            <figure class="init">
                <div id="figure-1">
                    <h2>Introduction</h2>
                    <p>A recent analysis by the <a
                            href="https://www.aei.org/carpe-diem/three-charts-based-on-todays-census-report-show-that-the-us-middle-class-is-shrinking-because-theyre-moving-up/"
                            target="_blank">American Enterprise Institute</a> found the middle class in the United
                        States is shrinking. They adjusted data from the U.S. Census Bureau for inflation and broke
                        households into three income levels: low-income, middle-income and high-income. They found the
                        share of households in the middle-income level is shrinking over time because not because the
                        low-income class is growing but because they are moving up into the high-income class.</p>
                    <p>I began to wonder what about New York State? Is the story the same? Or is it different? However I
                        wanted to look at the county level. I followed a similar methodology and created a dataset. I
                        outline the process <a href="#conclusion">later in this document</a> but first let me share with
                        you what I found.</p>
                </div>
                <div id="figure-2">
                    <select id="dropdown">
                        <option value="36001" selected>Albany County</option>
                        <option value="36003">Allegany County</option>
                        <option value="36005">Bronx County</option>
                        <option value="36007">Broome County</option>
                        <option value="36009">Cattaraugus County</option>
                        <option value="36011">Cayuga County</option>
                        <option value="36013">Chautauqua County</option>
                        <option value="36015">Chemung County</option>
                        <option value="36017">Chenango County</option>
                        <option value="36019">Clinton County</option>
                        <option value="36021">Columbia County</option>
                        <option value="36023">Cortland County</option>
                        <option value="36025">Delaware County</option>
                        <option value="36027">Dutchess County</option>
                        <option value="36029">Erie County</option>
                        <option value="36031">Essex County</option>
                        <option value="36033">Franklin County</option>
                        <option value="36035">Fulton County</option>
                        <option value="36037">Genesee County</option>
                        <option value="36039">Greene County</option>
                        <option value="36041">Hamilton County</option>
                        <option value="36043">Herkimer County</option>
                        <option value="36045">Jefferson County</option>
                        <option value="36047">Kings County</option>
                        <option value="36049">Lewis County</option>
                        <option value="36051">Livingston County</option>
                        <option value="36053">Madison County</option>
                        <option value="36055">Monroe County</option>
                        <option value="36057">Montgomery County</option>
                        <option value="36059">Nassau County</option>
                        <option value="36061">New York County</option>
                        <option value="36063">Niagara County</option>
                        <option value="36065">Oneida County</option>
                        <option value="36067">Onondaga County</option>
                        <option value="36069">Ontario County</option>
                        <option value="36071">Orange County</option>
                        <option value="36073">Orleans County</option>
                        <option value="36075">Oswego County</option>
                        <option value="36077">Otsego County</option>
                        <option value="36079">Putnam County</option>
                        <option value="36081">Queens County</option>
                        <option value="36083">Rensselaer County</option>
                        <option value="36085">Richmond County</option>
                        <option value="36087">Rockland County</option>
                        <option value="36089">St. Lawrence County</option>
                        <option value="36091">Saratoga County</option>
                        <option value="36093">Schenectady County</option>
                        <option value="36095">Schoharie County</option>
                        <option value="36097">Schuyler County</option>
                        <option value="36099">Seneca County</option>
                        <option value="36101">Steuben County</option>
                        <option value="36103">Suffolk County</option>
                        <option value="36105">Sullivan County</option>
                        <option value="36107">Tioga County</option>
                        <option value="36109">Tompkins County</option>
                        <option value="36111">Ulster County</option>
                        <option value="36113">Warren County</option>
                        <option value="36115">Washington County</option>
                        <option value="36117">Wayne County</option>
                        <option value="36119">Westchester County</option>
                        <option value="36121">Wyoming County</option>
                        <option value="36123">Yates County</option>
                    </select>
                    <div class="viz_container">
                        <div id="toggle_container">
                            Auto-advance <input type="checkbox" id="toggle" class="checkbox" />
                            <label for="toggle" class="switch"></label>
                        </div>
                        <div id="viz"></div>
                    </div>
                    <div class="range">
                        <input type="range" min="0" max="4" value="0" class="slider" id="slider">
                        <div class="sliderticks">
                            <p>1980</p>
                            <p>1990</p>
                            <p>2000</p>
                            <p>2007-12</p>
                            <p>2013-17</p>
                        </div>
                    </div>
                </div>
                <div id="figure-3">
                    <select id="stacked-viz-dropdown">
                        <option value="36001" selected>Albany County</option>
                        <option value="36003">Allegany County</option>
                        <option value="36005">Bronx County</option>
                        <option value="36007">Broome County</option>
                        <option value="36009">Cattaraugus County</option>
                        <option value="36011">Cayuga County</option>
                        <option value="36013">Chautauqua County</option>
                        <option value="36015">Chemung County</option>
                        <option value="36017">Chenango County</option>
                        <option value="36019">Clinton County</option>
                        <option value="36021">Columbia County</option>
                        <option value="36023">Cortland County</option>
                        <option value="36025">Delaware County</option>
                        <option value="36027">Dutchess County</option>
                        <option value="36029">Erie County</option>
                        <option value="36031">Essex County</option>
                        <option value="36033">Franklin County</option>
                        <option value="36035">Fulton County</option>
                        <option value="36037">Genesee County</option>
                        <option value="36039">Greene County</option>
                        <option value="36041">Hamilton County</option>
                        <option value="36043">Herkimer County</option>
                        <option value="36045">Jefferson County</option>
                        <option value="36047">Kings County</option>
                        <option value="36049">Lewis County</option>
                        <option value="36051">Livingston County</option>
                        <option value="36053">Madison County</option>
                        <option value="36055">Monroe County</option>
                        <option value="36057">Montgomery County</option>
                        <option value="36059">Nassau County</option>
                        <option value="36061">New York County</option>
                        <option value="36063">Niagara County</option>
                        <option value="36065">Oneida County</option>
                        <option value="36067">Onondaga County</option>
                        <option value="36069">Ontario County</option>
                        <option value="36071">Orange County</option>
                        <option value="36073">Orleans County</option>
                        <option value="36075">Oswego County</option>
                        <option value="36077">Otsego County</option>
                        <option value="36079">Putnam County</option>
                        <option value="36081">Queens County</option>
                        <option value="36083">Rensselaer County</option>
                        <option value="36085">Richmond County</option>
                        <option value="36087">Rockland County</option>
                        <option value="36089">St. Lawrence County</option>
                        <option value="36091">Saratoga County</option>
                        <option value="36093">Schenectady County</option>
                        <option value="36095">Schoharie County</option>
                        <option value="36097">Schuyler County</option>
                        <option value="36099">Seneca County</option>
                        <option value="36101">Steuben County</option>
                        <option value="36103">Suffolk County</option>
                        <option value="36105">Sullivan County</option>
                        <option value="36107">Tioga County</option>
                        <option value="36109">Tompkins County</option>
                        <option value="36111">Ulster County</option>
                        <option value="36113">Warren County</option>
                        <option value="36115">Washington County</option>
                        <option value="36117">Wayne County</option>
                        <option value="36119">Westchester County</option>
                        <option value="36121">Wyoming County</option>
                        <option value="36123">Yates County</option>
                    </select>
                    <div class="viz_container">
                        <div id="stacked-viz"></div>
                    </div>
                </div>
                <div id="figure-4">
                    <a name="conclusion"></a>
                    <h2>Methodolgy</h2>
                    <p>In creating the data for this analysis I tried to follow the American Enterprise Institute's
                        methodology
                        where I could but had to use different data sources</p>
                    <h3>Data Sources</h3>
                    <h4>Income &amp; Median Household Income</h4>
                    <p>The original study was based off of CPS data. This study did not use the CPS because it is not
                        designed
                        to produce reliable statistics below the state level. Instead we will be relying on the Decenial
                        Census
                        and American Community Survey (ACS) data. They provide data on the number of households by
                        income class.
                    </p>
                    <ul>
                        <li>
                            <p><strong>1980</strong> - 1980 U.S. Census, General Social and Economic Characteristics,
                                Table 180.
                                Income Characteristics in 1979 for Counties: 1980</p>
                        </li>
                        <li>
                            <p><strong>1990</strong> - 1990 U.S. Census, Social and Economic Characteristics, Table 148.
                                Income
                                in 1989 of Households, Families, and Persons: 1990</p>
                        </li>
                        <li>
                            <p><strong>2000</strong> - 2000 U.S. Census, Table P052. Household Income in 1999</p>
                        </li>
                        <li>
                            <p><strong>2008-2012 &amp; 2013-2017</strong> - American Community Survey, 5 Year Estimates,
                                Table
                                B19001. Household Income in the Past 12 Months</p>
                        </li>
                    </ul>
                    <h4>Inflation</h4>
                    <p>The original study adjusted the income figures for inflation using the <a
                            href="https://www.bls.gov/cpi/research-series/home.htm">CPI-U-RS</a> series. I used the same
                        series
                        to adjust our income figures into 2018 dollars.</p>
                </div>
            </figure>
        </section>

        <section>


        </section>
    </main>
    <script src="https://unpkg.com/d3@5.9.1/dist/d3.min.js"></script>
    <script src="https://unpkg.com/intersection-observer@0.5.1/intersection-observer.js"></script>
    <!--<script src="https://russellgoldenberg.github.io/scrollama/stickyfill.min.js"></script>-->
    <script src="https://russellgoldenberg.github.io/scrollama/scrollama.min.js"></script>
    <script src="all_data.js"></script>
    <script>
        // using d3 for convenience
        var main = d3.select("main")
        var scrolly = main.select("#scrolly");
        var figure = scrolly.select("figure");
        var article = scrolly.select("article");
        var step = article.selectAll(".step");
        var key = 0;
        var step_showing;
        var geoid = $("#dropdown").val();
        var viz_data;

        var viz_plotly_data = [{
            type: "bar",
            x: x(),
            y: ["Low ", "Middle ", "High "],
            orientation: "h",
            marker: { color: ["#fdcb6e", "#0984e3", "#d63031"] },
        }];

        var viz_plotly_layout = {
            xaxis: { range: [0, 60] },
            showlegend: false,
            title: "Share of Households by Income Level (%)"
        };

        var viz_plotly_options = {
            responsive: true,
            scrollZoom: false, // lets us scroll to zoom in and out - works
            showLink: false, // removes the link to edit on plotly - works
        };

        var stacked_viz_layout = {
            barmode: "overlay",
            xaxis: {
                type: 'category'
            },
            title: "Are Households Moving Up or Down?"
        };

        // initialize the scrollama
        var scroller = scrollama();

        function get_stacked_viz_data(){
            stacked_viz_geoid = $("#stacked-viz-dropdown").val();
            var high = {
                x: [],
                y: [],
                textposition: 'auto',
                name: 'High',
                hoverinfo: 'none',
                marker: {
                    color: '#d63031',
                }, 
                type: 'bar'
            };
            var middle = {
                x: [],
                y: [],
                textposition: 'auto',
                name: 'Middle',
                hoverinfo: 'none',
                marker: {
                    color: '#0984e3',
                }, 
                type: 'bar'
            };
            var low = {
                x: [],
                y: [],
                textposition: 'auto',
                name: 'Low',
                hoverinfo: 'none',
                marker: {
                    color: '#fdcb6e',
                },  
                type: 'bar'
            };

            low_vals = [];
            middle_vals = [];
            high_vals = [];

            $.each(all_data[stacked_viz_geoid], function( index, d){
                l = Math.round(d['low_share'] * 100,0);
                m = Math.round(d['middle_share'] * 100,0);
                h = Math.round(d['upper_share'] * 100,0);
                low_vals[index] = l + "%";
                middle_vals[index] = m + "%";
                high_vals[index] = h + "%";
                low['x'][index] = middle['x'][index] = high['x'][index] = d['label']; 
                low['y'][index] = l * -1;               
                middle['y'][index] = m;
                high['y'][index] = m + h;
            });

            low['text'] = low_vals.map(String);
            middle['text'] = middle_vals.map(String);
            high['text'] = high_vals.map(String);

            return([high, middle, low]);
        }

        function handleResize() {
            var stepH = Math.floor(window.innerHeight * 0.75);
            step.style("height", stepH + "px");
            var figureHeight = window.innerHeight / 2;
            figure
                .style("height", figureHeight + "px")
                .style("top", 0 + "px");
            scroller.resize();
        }

        function handleStepEnter(response) {
            step_showing = response.index + 1;
            figure.attr("class", null).classed("step-" + step_showing, true);
        }

        function init() {
            handleResize();

            scroller.setup({
                step: "#scrolly article .step",
                offset: 0.3,
                debug: false,
            }).onStepEnter(handleStepEnter);
            // setup resize event
            window.addEventListener("resize", handleResize);
            // Start the auto advancer
            setTimeout(change_year, 1000);
        }

        function x() {
            viz_data = all_data[geoid];
            return [Math.round(viz_data[key]["low_share"] * 100, 0), Math.round(viz_data[key]["middle_share"] * 100, 0), Math.round(viz_data[key]["upper_share"] * 100, 0)];
        }

        function update_viz() {
            Plotly.animate("viz", {
                data: [{ x: x(), }],
                traces: [0],
                layout: {}
            }, {
                transition: {
                    duration: 500,
                    easing: "cubic-in-out"
                },
                frame: {
                    duration: 500
                }
            })
        }

        function change_dropdown() {
            if ($("#dropdown option:selected").val() == "36123") {
                $("#dropdown option:selected").attr("selected", false);
                $("#dropdown option:first").attr("selected", "selected");
            } else {
                $("#dropdown option:selected").attr("selected", false).next().attr("selected", "selected");
            }
        }

        function change_year() {
            var auto_advance = !$("#toggle").prop('checked');
            if (step_showing == 2 && auto_advance) {
                key++;
                if (key == 5) {
                    change_dropdown();
                    key = 0;
                }
                $("#slider").val(key);
                update_viz();
            }
            setTimeout(change_year, 1000);
        }

        Plotly.newPlot("viz", viz_plotly_data, viz_plotly_layout, viz_plotly_options);
        
        Plotly.newPlot("stacked-viz", get_stacked_viz_data(), stacked_viz_layout);

        // Events

        $("#dropdown").change(function () {
            key = 0;
            geoid = $("#dropdown").val();
            $("#slider").val(key);
            update_viz();
        });

        $('#stacked-viz-dropdown').change(function(){
            Plotly.newPlot("stacked-viz", get_stacked_viz_data(), stacked_viz_layout);
        });

        $("#slider").change(function () {
            key = $(this).val();
            update_viz();
        });

        init();
    </script>
</body>

</html>